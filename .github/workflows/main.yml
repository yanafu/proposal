# ワークフローの名前（GitHubのActionsタブで表示される）
name: AXEL-Strategy-Partner-Workflow

# ワークフローが起動する「きっかけ」（トリガー）
on:
  issues:
    types: [labeled] # Issueにラベルが貼られたとき

# 実行される一連の「仕事」（ジョブ）
jobs:
  # ジョブの名前（好きな名前を付けられる）
  run-logos-agent:
    # このジョブが動くための「条件」
    # "initiate-proposal" という名前のラベルが貼られたときだけ実行する
    if: github.event.label.name == 'initiate-proposal'
    
    # ジョブを実行する仮想マシンの種類を指定（最新のUbuntu）
    runs-on: ubuntu-latest

    # ジョブの具体的な「手順」（ステップ）
    steps:
      # ステップ1: リポジトリのコードを仮想マシンにコピーする
      - name: Checkout repository
        uses: actions/checkout@v4

      # ステップ2: Pythonの実行環境をセットアップする
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12' # あなたがインストールしたバージョンに近いもの

      # ステップ3: Pythonのライブラリ（openai）をインストールする
      - name: Install dependencies
        run: pip install openai

      # ステップ4: Logosエージェント（Pythonスクリプト）を実行する
      - name: Run Logos Agent to generate proposal plan
        id: logos_step # このステップにIDを付けて、出力を後で参照できるようにする
        run: python src/logos_agent.py
        env:
          # Pythonスクリプトに環境変数として情報を渡す
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_BODY: ${{ github.event.issue.body }}

      # ステップ5: Logosの実行結果を、元のIssueにコメントとして投稿する
      - name: Create comment on Issue with Logos's plan
        uses: peter-evans/create-or-update-comment@v4
        with:
          # どのIssueにコメントするかを指定
          issue-number: ${{ github.event.issue.number }}
          # コメントの内容を指定
          # logos_stepというIDを付けたステップの出力（proposal_plan）を参照している
          body: ${{ steps.logos_step.outputs.proposal_plan }}