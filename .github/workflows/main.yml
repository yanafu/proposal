name: AXEL-Orchestrator-Workflow

on:
  issues:
    types: [labeled]

permissions:
  issues: write

jobs:
  # ジョブの名前を「司令塔」や「分配係」のように汎用的にする
  agent-dispatcher:
    runs-on: ubuntu-latest
    steps:
      # ステップ1: Logosを起動する (initiate-proposal ラベルの場合)
      - name: Invoke Logos for Initial Proposal
        # if条件は、どのラベルでどのエージェントを呼ぶかの「司令」
        if: github.event.label.name == 'initiate-proposal'
        id: logos_job
        # ★変更点！ 新しい汎用アクションを呼び出す
        uses: ./.github/actions/run-python-agent
        with:
          # 実行させたいPythonスクリプトのパスをここで指定
          agent_script_path: src/logos_agent.py
          # 以下は、アクションに渡す情報
          triggering_label: ${{ github.event.label.name }}
          issue_title: ${{ github.event.issue.title }}
          issue_body: ${{ github.event.issue.body }}
          openai_api_key: ${{ secrets.OPENAI_API_KEY }}

      # (将来、Athenaをここに追加する場合のイメージ)
      # - name: Invoke Athena for Research Planning
      #   if: github.event.label.name == 'plan-research'
      #   id: athena_job
      #   uses: ./.github/actions/run-python-agent
      #   with:
      #     agent_script_path: src/athena_agent.py
      #     ... (必要な情報を渡す) ...

      # ステップ2: エージェントからの出力をIssueにコメントする
      - name: Post Comment to Issue
        # Logosのジョブが何かしらの結果を出した場合に実行
        if: steps.logos_job.outputs.comment_body
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: ${{ steps.logos_job.outputs.comment_body }}